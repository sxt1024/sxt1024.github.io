---
title: "2.5_磁盘"
date: 2018-11-10T11:27:28
lastmod: 2018-11-10
timezone: UTC+8
tags: ["操作系统"]
categories: ["操作系统"]
draft: false
---




## 磁盘



### 软盘和硬盘

目前主流的硬盘分为两种：

- 机械硬盘

- 固态硬盘

硬盘最早分为两种接口方式：

- 并行接口（PATA），目前已经淘汰。

- 串行接口（SATA）。



### 磁盘寻址：CHS方式

磁盘的三层定位结构分别为

- 柱面(Cylinder)
- 磁头(Head)
- 扇区(Sector)

磁盘寻址，是指根据给出的方式找到扇区的位置。

按顺序根据柱面，磁头，扇区，这种方式称之为CHS方式。

例如: 磁盘的第一个扇区，位于 1柱面，1磁头，0扇区



**CHS方式表示的容量上限**

这种模式及下，支持的最大柱面数为1024，最大磁头数为16，最大扇区数为63，（每个扇区字节数为512Bit）因此最大访问硬盘容量为：

> 1024 x 16 x 64 x 512 = 528MB

虽然后面又拓展了large模式读取，但是没有解决根本问题。

所以后来有LBA的读取方式，可以描述更大容量。




### 磁盘寻址：LBA方式

LBA方式不考虑扇区的物理位置，而是根据逻辑位置来寻址的。

LBA方式不使用`柱面-磁头-扇区`方式定位，直接以从0开始，逐次递增的方式来定位逻辑扇区。

比如： 扇区0，扇区1，....   

**LAB寄存器**

LAB使用硬盘控制器存储扇区定位信息。每个寄存器8位大小。

- device寄存器: 

- LBA low寄存器

- LBA mid寄存器

- LBA high寄存器 


例如LAB28，使用一个28位来表示扇区位置。

>  LAB28扇区地址 = device寄存器的低4位 + LBA high寄存器 + LBA mid寄存器 + LBA low寄存器



**LAB28 和 LAB48**

IO操作读取硬盘的三种寻址方式：

- chs寻址方式 ：小于8G (8064MB)
- LBA28寻址方式：小于137GB
- LBA48寻址方式：小于144,000,000 GB





### CHS和LBA的转换

CHS地址可用以下公式转成LBA,

```
LBA = (C * H + H) * S + S - 1     
```
LBA可用以下公式对应到CHS:
```
C = LBA / (SPT * HPC)
H = (LBA / SPT ) % HPC
S = (LBA % SPT ) + 1 
```

C =  cylinder : 磁柱编号
H =  head:  磁头编号
S  =  sector:  扇区编号
HPC=heads per cylinder，每个磁柱的磁头数
SPT=sectors per track，每磁道的扇区数









功能08H 功能描述：读取驱动器参数 入口参数：

AH＝08H 

DL＝驱动器，00H~7FH：软盘；80H~0FFH：硬盘 

出口参数：

CF＝1——操作失败，

AH＝状态代码，参见功能号01H中的说明，否则， BL＝01H — 360K ＝02H — 1.2M ＝03H — 720K ＝04H — 1.44M 

CH＝柱面数的低8位 

CL的位7-6＝柱面数的该2位

 CL的位5-0＝扇区数 

DH＝磁头数 

DL＝驱动器数 

ES:DI＝磁盘驱动器参数表地址 



