## 为什么要分页





1. 实模式分段:  

   - 原因: cpu段寄存器太小,  和cpu总线不匹配. ( cpu段寄存器16位,cpu总线20位.)

   - 解决方式,通过 段寄存器 , 指针寄存器 ,两者配合使用.
2. 保护模式分段: 

   - 原因:  

   - 解决方法:创建全局描述符表, 段寄存器存储的是选择子, 可以使用更多内存.
3. 分页：
   - 原因:  实际物理地址存在范围比较小, 且不连续的问题



### 1.2 不同架构的分页机制

inux采用的四级页表目录的大小有所不同：对于i386而言，仅采用二级页表，即页上层目录和页中层目录长度为0；对于启用PAE的i386，采用了三级页表，即页上层目录长度为0；对于64位体系结构，可以采用三级或四级页表，具体选择由硬件决定。



从上述过程中，可以看出，对虚拟地址的**分级解析**过程，实际上就是不断深入页表层次，逐渐定位到最终地址的过程，所以这一过程被叫做**page talbe walk**。

至于这种做法为什么能节省内存，举个更简单的例子更容易明白。比如要记录16个球场的使用情况，每张纸能记录4个场地的情况。采用4+4+4+4，共4张纸即可记录，但问题是球场使用得很少，有时候一整张纸记录的4个球场都没人使用。于是，采用4 x 4方案，即把16个球场分为4组，同样每张纸刚好能记录4组情况。这样，使用一张纸A来记录4个分组球场情况，当某个球场在使用时，只要额外使用多一张纸B来记录该球场，同时，在A上记录"某球场由纸B在记录"即可。这样在大部分球场使用很少的情况下，只要很少的纸即困记录，当有球场被使用，有需要再用额外的纸来记录，当不用就擦除。这里一个很重要的前提就是:**局部性**。

4G内存 ：  1024  * 1024 * 4    

一级分页 = 1024  * 1024  * （每项4字节）  =  4M

二级分页 = （1024  +  1024） * （每项4字节） =  8K （每项4字节）

- 为什么要使用多级页表

  

  多级页表优势：

  1.可以离散存储页表。

  2.在某种意义上节省页表内存空间。

  多级页表劣势：

  增加寻址次数，从而延长访存时间。

  

  那么使用多级页表比使用以及页表有没有什么劣势呢？

  当然是有的。比如：使用以及页表时，读取内存中一页内容需要2次访问内存，第一次是访问页表项，第二次是访问要读取的一页数据。但如果是使用二级页表的话，就需要3次访问内存了，第一次访问页目录项，第二次访问页表项，第三次访问要读取的一页数据。访存次数的增加也就意味着访问数据所花费的总时间增加。



## 页表到页表的寻址

