---
title: 1.1 Arch搭建Nas系统之一：安装Arch系统
date: 2024-10-01T12:27:28
lastmod: 2024-10-30
timezone: UTC+8
tags:
  - nas
categories: nas
draft: false
---

### 1.1 准备U盘

准备一个8G以上的U盘

### 1.2 准备安装包

下载Arch的ISO文件：

下载地址：[Download . Arch](https://archlinux.org/download/)

下载Ventoy安装工具

下载地址： [Download . Ventoy](https://www.ventoy.net/cn/download.html)

**1.2.2 安装 Ventoy**

解压ventoy压缩包，执行 Ventoy2Disk.exe

![assets/nas001.pg](./assets/nas001.png)

设备选择U盘，点击安装. 等待安装完成

**1.2.3 复制ISO文件到u盘**

将下载好的arch的ISO文件复制到准备好的U盘根目录

**1.2.4 准备安装Arch**

a) 将U盘插入电脑，从USB启动，进入Ventoy安装界面，然后后选择 Arch 的镜像，等待重启加载。

b) 当引导加载程序菜单出现时，选择 *Arch Linux install medium* 并按 `Enter` 进入安装环境。

c) 成功进入root用户的命令行界面。

### 1.3 磁盘分区

**1.3.1 格式化分区**

首先需要查看所有磁盘，并决定系统安装在哪一个盘。

a) 查看当前所有磁盘：

```
lsblk
```

> 例如如果为m2固态，名称类似/dev/nvme0n。如果为机械盘，名称类似/dev/sda。

b) 对指定磁盘执行分区

```
parted   /dev/nvme0n1                    #【选择一个磁盘进行分区】

mklabel gpt                              #【建立gpt分区表】

mkpart "EFI" fat32  1MiB 1025MiB               #【建立ESP分区，用于挂载efi分区（uefi模式必须要有efi分区）】   

mkpart "root" ext4  1025MiB  100%             #【创建/分区，剩余所有容量 】

p                                         #【打印分区信息】

set 1 esp on                              #【设定ESP分区标志为boot】

q                                         # 【退出】                                                                 #【退出】
```


格式化分区命令

mkfs.vfat -F 32 /dev/nvme0n1p1     【esp】

mkfs.ext4 /dev/nvme0n1p2           【根目录】

### 1.4. 挂载磁盘分区

挂载分区

执行blkid查看分区

挂载分区，安装系统时可以访问，并安装boot，home，data目录文件到挂载的分区。


```

mount /dev/nvme0n1p2 /mnt                #【首先挂载根目录】

mkdir /mnt/boot
mount /dev/nvme0n1p1 /mnt/boot           #【在根目录下挂载boot分区】      
```

执行查看挂载结果

```
df-h
```

### 1.5. 安装Arch系统

**1.5.1 测试网络**

使用ping命令测试网络延迟

```shell
ping -c 3 www.qq.com
```

**1.5.2 设置软件源**

我觉得不换速度也OK，可以尝试换国内源。具体自行百度。

**1.5.3 安装基本包**

```
pacstrap /mnt base base-devel linux linux-firmware dhcpcd  iwd 
pacstrap /mnt vim nano wget
```

系统会安装并挂载在/mnt目录下面

**1.5.4 生成fstab文件**

生成fstab文件

```shell
$ genfstab -U -p /mnt >> /mnt/etc/fstab
```

### 1.6 安装引导

**1.6.1 进入系统**

```
arch-chroot /mnt
```

**1.6.2 安装Systemd-boot引导**

```
bootctl  install
```

**1.6.3 修改引导配置**

```

vim /boot/loader/entries/arch.conf

内容
title          Arch Linux
linux          /vmlinuz-linux
initrd         /initramfs-linux.img
options        root=UUID=XXXXXXXXXXXXXXXXXXX rw
```

> XXXXXXXXXXXXXXXXXXX配置为磁盘分区的UUID
> 
> 注意是查找的 系统  /根目录挂载分区  UUID 名称。
> 
> 例如：/dev/sdaX 的 UUID="d4539375-8c4d-4721-ac18-ed3f645bc589"

```

vim /boot/loader/loader.conf

内容
default  arch  
timeout  5
console-mode max  
editor   no 
:wq!
```

使用bootctl更新Systemd-boot：

```
bootctl update
```

检查当前的Systemd-boot配置：

```
bootctl list
```

### 1.7 配置nas用户

**1.7.1 设置root密码**

```
# passwd root
```

**1.7.2 创建nas用户**

```
groupadd archnas
useradd -m -g archnas archnas
passwd archnas
```

**1.7.2 加入sudo权限**

编辑sudo配置

```
touch /etc/sudoers.d/sudo_users
echo "archnas ALL=(ALL:ALL)  NOPASSWD:ALL"  >> /etc/sudoers.d/sudo_users
```



### 1.11 重启系统

重启系统，看下是否能正常进入引导。如果无法引导，那么就说明引导的配置有问题，需要检查配置。

如果重启成功引导并进入系统就可以进行下一步配置了。

exit
reboot


### 1.8 配置SSH


**1.8.2 配置有线网络**

a) 查询网卡名称

```
ip addr
```

根据列表。找到有线网卡名称：eth0 或者其他名例如（enp1s0）

b) 修改网络配置

不配置的话通常地址IP是自动获取的，会变。所以需要设置成静态地址。

```
vim /etc/dhcpcd.conf

文件的最后加入内容
interface  enp1s0
static ip_address=192.168.10.222/24    
static routers=192.168.10.1
static domain_name_servers=192.168.10.1
```

以上配置只供参考。需要配置你自己当前环境的网段IP。我的网段是（192.168.10.X）

c) 保存后，重启dhtpcd网络服务

```
systemctl restart dhcpcd && systemctl enable dhcpcd
```


### 1.12 其他：无线联网方式

查看设备

```
ip addr
```

执行命令

```
## 开启iwctl服务（如果失败，可能需要重启）
systemctl enable --now iwd
```

```
## 查看网卡设备
iwctl device list
iwctl station list

## 搜索可以连接的wifi
iwctl station [设备名] scan

## 连接
iwctl station [设备名] connect [wifi网络名]
输入密码

## 查看连接状态
iwctl station  show
```







Archinstall方式
执行 
```
archinstall

1) archinstall language，选English
2) Mirrors，选china
2）Locale language 选择 zh_CN.UTF-8
3）创建分区，选择m2盘，建议分区，不使用home目录 
  ---（如果磁盘已经有分区，需要进parted删除分区）
4）新增安装包，选择vim nano wget
4）修改hostname
5）修改root密码
6）创建用户账号
7) Profile，选择Minumal
7）网络， 手动添加静态IP
8）时区，选择Asia/shanghai
```

点击install安装
